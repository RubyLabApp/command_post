%div{ class: "#{t.layout.page_wrapper} #{t.font_family}" }
  %div{ class: t.layout.page_header }
    %h1.text-2xl{ class: cp_heading } Audit Log

  - unless IronAdmin.configuration.audit_enabled
    %div{ class: "#{t.alert.base} #{t.alert.variants[:warning][:bg]} #{t.alert.variants[:warning][:border]} mb-6" }
      .flex
        .flex-shrink-0
          = heroicon "exclamation-triangle", variant: :mini, options: { class: "h-5 w-5 #{t.alert.variants[:warning][:text]}" }
        .ml-3
          %p.text-sm{ class: t.alert.variants[:warning][:text] }
            Audit logging is currently disabled. Enable it in your IronAdmin configuration:
            %code.ml-1.px-1.rounded{ class: "py-0.5 bg-yellow-100" } config.audit_enabled = true

  - if @entries.any?
    .mb-4
      = form_tag audit_path, method: :get, class: "flex gap-4 items-end" do
        .flex-1
          %label{ class: "#{t.filter.label} mb-1 #{cp_muted_text}" } Resource
          %select{ name: "resource", class: cp_select_class }
            %option{ value: "" } All Resources
            - IronAdmin::ResourceRegistry.all.each do |resource|
              %option{ value: resource.name, selected: params[:resource] == resource.name }= resource.label
        .flex-1
          %label{ class: "#{t.filter.label} mb-1 #{cp_muted_text}" } Action
          %select{ name: "action_filter", class: cp_select_class }
            %option{ value: "" } All Actions
            - %w[create update destroy].each do |action|
              %option{ value: action, selected: params[:action_filter] == action }= action.capitalize
        .flex-1
          %label{ class: "#{t.filter.label} mb-1 #{cp_muted_text}" } From
          = date_field_tag :from, params[:from], class: cp_filter_input_class
        .flex-1
          %label{ class: "#{t.filter.label} mb-1 #{cp_muted_text}" } To
          = date_field_tag :to, params[:to], class: cp_filter_input_class
        .flex.gap-2
          %button{ type: "submit", class: cp_btn_primary } Filter
          = link_to "Clear", audit_path, class: cp_btn_ghost

    - audit_action_colors = { create: :green, update: :blue, destroy: :red }
    %table{ class: "#{t.table.wrapper} #{cp_table_border} divide-y #{t.card_bg} #{t.border_radius} #{t.card_shadow}" }
      %thead{ class: cp_table_header_bg }
        %tr
          - %w[Timestamp User Action Resource Record\ ID IP\ Address Changes].each do |col|
            %th{ class: t.table.header_cell }= col
      %tbody{ class: "#{cp_table_border} divide-y" }
        - @entries.each do |entry|
          %tr{ class: cp_table_row_hover }
            %td{ class: "#{t.table.body_cell} #{cp_body_text}" }
              = entry.timestamp.strftime("%Y-%m-%d %H:%M:%S")
            %td{ class: "#{t.table.body_cell} #{cp_body_text}" }
              - if entry.user.respond_to?(:email)
                = entry.user.email
              - elsif entry.user.respond_to?(:name)
                = entry.user.name
              - elsif entry.user
                = entry.user.to_s
              - else
                %span{ class: cp_muted_text } Unknown
            %td{ class: t.table.body_cell }
              - color = audit_action_colors[entry.action.to_sym] || :gray
              %span{ class: "#{t.badge.base} #{t.badge.sizes[:sm]} #{t.badge.colors[color]}" }
                = entry.action.to_s.capitalize
            %td{ class: "#{t.table.body_cell} #{cp_body_text}" }
              = entry.resource
            %td{ class: "#{t.table.body_cell} #{cp_body_text}" }
              = entry.record_id
            %td{ class: "#{t.table.body_cell} #{cp_muted_text}" }
              = entry.ip_address || "-"
            %td{ class: "#{t.table.body_cell} #{cp_body_text}" }
              - if entry.changes.present? && entry.changes.any?
                %details
                  %summary.cursor-pointer{ class: cp_link }
                    = pluralize(entry.changes.keys.count, "field")
                    changed
                  .mt-2{ class: t.audit.diff_bg }
                    - entry.changes.each do |field, values|
                      .mb-1
                        %strong= field
                        \:
                        - if values.is_a?(Array) && values.length == 2
                          %span{ class: t.audit.diff_removed }= values[0].to_s.truncate(30)
                          = heroicon "arrow-right", variant: :mini, options: { class: "h-3 w-3 inline mx-1" }
                          %span{ class: t.audit.diff_added }= values[1].to_s.truncate(30)
                        - else
                          = values.to_s.truncate(50)
              - else
                %span{ class: cp_muted_text } -

  - else
    .text-center.py-12{ class: cp_muted_text }
      = heroicon "clipboard-document-list", variant: :outline, options: { class: "h-12 w-12 mx-auto mb-4" }
      %p.text-lg.font-medium No audit log entries found.
      %p.text-sm.mt-2 Activity will appear here once users perform actions.
