.p-8.max-w-7xl.mx-auto{ class: t.font_family }
  .flex.items-center.justify-between.mb-6
    %h1.text-2xl{ class: cp_heading }
      = @resource_class.model.model_name.human
      %span.text-gray-400= "##{@record.id}"
    .flex.gap-2
      - if @resource_class.action_allowed?(:update)
        = link_to I18n.t("command_post.resources.show.edit_button"), edit_resource_path(@resource_class.resource_name, @record),
          class: cp_btn_primary
      - if @resource_class.action_allowed?(:destroy)
        = button_to I18n.t("command_post.resources.show.delete_button"), resource_path(@resource_class.resource_name, @record),
          method: :delete, data: { turbo_confirm: I18n.t("command_post.resources.show.delete_confirm") },
          class: cp_btn_danger

  .overflow-hidden{ class: cp_card }
    %dl{ class: "#{cp_table_border} divide-y" }
      - @fields.each do |field|
        - next unless field.visible?(command_post_current_user)
        .px-6.py-4.flex.items-center
          %dt.text-sm.font-medium{ class: "w-1/3 #{cp_muted_text}" }= field.name.to_s.humanize
          %dd.text-sm{ class: "w-2/3 #{cp_body_text}" }= display_field_value(@record, field)

  - @resource_class.has_one_associations.each do |assoc|
    - related_record = @record.public_send(assoc[:name])
    - next unless related_record
    .mt-6.overflow-hidden{ class: cp_card }
      .px-6.py-4.border-b.flex.items-center.justify-between{ class: t.card_border }
        %h2.text-lg.font-semibold= assoc[:name].to_s.humanize
        = link_to I18n.t("command_post.resources.show.view_link"),
          resource_path(assoc[:resource].resource_name, related_record),
          class: "text-sm #{cp_link}"
      %dl{ class: "#{cp_table_border} divide-y" }
        - assoc[:resource].resolved_fields.first(6).each do |field|
          - next if field.name == :id
          - next unless field.visible?(command_post_current_user)
          .px-6.py-3.flex.items-center
            %dt.text-sm.font-medium{ class: "w-1/3 #{cp_muted_text}" }= field.name.to_s.humanize
            %dd.text-sm{ class: "w-2/3 #{cp_body_text}" }= display_field_value(related_record, field)

  - @resource_class.habtm_associations.each do |assoc|
    - related_records = @record.public_send(assoc[:name])
    - next if related_records.empty?
    .mt-6.overflow-hidden{ class: cp_card }
      .px-6.py-4.border-b{ class: t.card_border }
        %h2.text-lg.font-semibold= assoc[:name].to_s.humanize
      .px-6.py-4
        .flex.flex-wrap.gap-2
          - related_records.each do |related|
            - display = assoc[:display]
            - if assoc[:resource]
              = link_to display_record_label(related, display),
                resource_path(assoc[:resource].resource_name, related),
                class: "inline-flex px-3 py-1 text-sm font-medium rounded-full bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors"
            - else
              %span.inline-flex.px-3.py-1.text-sm.font-medium.rounded-full.bg-gray-100.text-gray-700
                = display_record_label(related, display)

  - @resource_class.has_many_associations.each do |assoc|
    - related_records = @record.public_send(assoc[:name]).limit(20)
    - next if related_records.empty?
    .mt-6.overflow-hidden{ class: cp_card }
      .px-6.py-4.border-b.flex.items-center.justify-between{ class: t.card_border }
        %h2.text-lg.font-semibold= assoc[:name].to_s.humanize
        = link_to I18n.t("command_post.resources.show.view_all"),
          resources_path(assoc[:resource].resource_name),
          class: "text-sm #{cp_link}"
      %table.min-w-full{ class: "#{cp_table_border} divide-y" }
        %tbody{ class: "#{cp_table_border} divide-y" }
          - related_records.each do |related|
            %tr{ class: cp_table_row_hover }
              %td.px-6.py-3.text-sm{ class: cp_body_text }
                - display = assoc[:display]
                = link_to display_record_label(related, display),
                  resource_path(assoc[:resource].resource_name, related),
                  class: cp_link

  - if @resource_class.defined_actions.any?
    .mt-6.p-6{ class: cp_card }
      %h2.text-lg.font-semibold.mb-4= I18n.t("command_post.resources.show.actions_label")
      .flex.gap-2
        - @resource_class.defined_actions.each do |action|
          = button_to resource_action_path(@resource_class.resource_name, @record, action[:name]),
            data: action[:confirm] ? { turbo_confirm: I18n.t("command_post.resources.show.delete_confirm") } : {},
            class: cp_btn_ghost do
            - if action[:icon]
              = heroicon action[:icon], variant: :outline, options: { class: "h-5 w-5" }
            = action[:name].to_s.humanize
