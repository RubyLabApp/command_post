.p-8.max-w-7xl.mx-auto{ class: t.font_family }
  %h1.text-2xl.mb-6{ class: cp_heading }= CommandPost.configuration.title

  - if @dashboard
    - if @dashboard.defined_metrics.any?
      .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4.gap-6.mb-8
        - @dashboard.defined_metrics.each do |metric|
          = render CommandPost::Dashboards::MetricCardComponent.new(name: metric[:name], value: metric[:block].call, format: metric[:format])

    - if @dashboard.defined_charts.any?
      = javascript_include_tag "chart.min", defer: true, onload: "document.dispatchEvent(new Event('chartjs:loaded'))"
      .grid.grid-cols-1.lg:grid-cols-2.gap-6.mb-8
        - @dashboard.defined_charts.each do |chart|
          - chart_data = chart[:block].call
          - labels = chart_data.keys
          - data = chart_data.values
          = render CommandPost::Dashboards::ChartComponent.new(title: chart[:name].to_s.humanize, type: chart[:type], data: data, labels: labels, colors: chart[:colors])

    - if @dashboard.defined_recents.any?
      .space-y-6
        - @dashboard.defined_recents.each do |recent|
          - resource_class = CommandPost::ResourceRegistry.find(recent[:resource_name].to_s.pluralize)
          - if resource_class
            - scope = recent[:scope] ? resource_class.model.instance_exec(&recent[:scope]) : resource_class.model.all
            - records = scope.limit(recent[:limit])
            = render CommandPost::Dashboards::RecentTableComponent.new(resource_name: recent[:resource_name], records: records)

  - else
    .p-12.text-center{ class: cp_card }
      %p{ class: cp_muted_text } No dashboard configured. Create an AdminDashboard in app/command_post/.
